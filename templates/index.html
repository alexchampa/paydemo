{% extends "layout.html" %}

{% block demo_panel_content %}
    <h3>Welcome to the B2B Demo!</h3>
    <p>This is the main product page where you can begin to explore the demo's features.</p>
    
    <h4>1. Select a Currency ðŸ’¶</h4>
    <p>Use the <strong>currency switcher (USD/GBP/EUR)</strong> in the header. Changing the currency will regionalize the entire demo, updating the available login accounts and company data to match that region.</p>

    <h4>2. Start Shopping ðŸ›’</h4>
    <p>Browse the products on this page and add items to your cart. You can click on any product to view its details page with customer reviews.</p>
    
    <h4>3. Login Workflow ðŸ”‘</h4>
    <p>You can log in at any time using the button in the header. If you proceed to checkout without being logged in, the system will automatically prompt you to authenticate before completing the purchase.</p>
{% endblock %}

{% block content %}
    <div class="product-grid">
        {% for product in products %}
            <div class="product-card">
                <a href="{{ url_for('product_detail', product_id=product.id) }}" class="product-card-main-link">
                    <div class="product-image">
                        <img src="{{ url_for('static', filename=product.image) }}" alt="{{ product.name }}">
                    </div>
                    <h2 class="product-name">{{ product.name }}</h2>
                </a>

                <div class="product-card-rating">
                    {% for i in range(5) %}
                        {% if i < product.avg_rating|round(0, 'floor') %}
                            <span class="star filled">&#9733;</span>
                        {% else %}
                            <span class="star">&#9734;</span>
                        {% endif %}
                    {% endfor %}
                </div>

                <p class="product-description">{{ product.description | truncate(80, True, '...') }}</p>
                
                <div class="product-footer">
                    <p class="product-price">{{ product.price | to_currency }}</p>
                    <div class="product-buttons">
                        <a href="{{ url_for('add_to_cart', product_id=product.id) }}" class="btn btn-secondary add-to-cart-btn">Add to Cart</a>
                        <a href="{{ url_for('product_detail', product_id=product.id) }}" class="btn">Details</a>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% if show_popup %}
<div class="modal-overlay is-visible">
    <div class="modal-window">
        <button class="modal-close">&times;</button>
        <div class="modal-image">
            <img src="{{ url_for('static', filename='images/banner-final.png') }}" alt="Business professional">
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const modalOverlay = document.querySelector('.modal-overlay');
        const closeModalBtn = document.querySelector('.modal-close');

        if (modalOverlay && closeModalBtn) {
            // Function to close the modal
            const closeModal = () => modalOverlay.classList.remove('is-visible');

            // Close when clicking the 'x' button
            closeModalBtn.addEventListener('click', closeModal);

            // Optional: Close when clicking on the dark background
            modalOverlay.addEventListener('click', (event) => {
                if (event.target === modalOverlay) {
                    closeModal();
                }
            });
        }
    });
</script>
{% endif %}
{% endblock %}